# YouTube字幕電子書製作器 V2.0

將YouTube影片的硬編碼字幕截圖並組合成可翻頁閱讀的電子書格式。

## ✨ V2.0 新功能

### 🎨 全新 Side Panel 介面
- 現代化深色主題設計
- 側邊面板取代彈出視窗，更大操作空間
- 手風琴式進階設定，介面更簡潔

### 📚 書庫管理系統 (Library Manager)
- 統一管理所有已儲存的字幕段落
- 支援搜尋、排序、批次操作
- 多段落選取與合併導出
- 資料導入/導出功能

### 📄 多格式導出
- **PDF 導出**：單檔或多段落合併導出
- **HTML 有聲書**：可離線播放的互動式有聲書
- **資料備份**：JSON 格式完整導出

### 📖 即時閱讀器 (Live Reader)
- 製作過程中即時預覽已完成頁面
- 獨立視窗運作，不干擾截圖流程
- 完整編輯功能支援

### 🤖 智慧擷取模式 (Beta)
- 自動偵測字幕變化
- 比固定間隔更精準
- 可調整靈敏度與檢測參數

## 🎯 功能總覽

### 核心功能
- ✅ **自動截取**：自動截取影片字幕區域
- ✅ **頁面組合**：組合成多行字幕的頁面
- ✅ **全螢幕閱讀**：沉浸式閱讀體驗
- ✅ **音訊同步**：翻頁時同步播放對應音訊

### 編輯功能
- ✅ **插入截圖**：複製並插入新截圖
- ✅ **調整時間戳記**：微調截圖時間點
- ✅ **新增上方字幕**：添加上方區域截圖
- ✅ **刪除截圖**：移除不需要的截圖

### 播放控制
- ✅ **靜音/取消靜音**
- ✅ **多段倍速控制** (1x, 1.25x, 1.5x, 2x)
- ✅ **翻頁自動播放**

### 進階功能
- ✅ **即時預覽**：在製作前預覽設定效果
- ✅ **雙視窗模式**：支援一邊截圖一邊閱讀/編輯
- ✅ **製作加速**：自動靜音並以 2x 速度播放

## 📦 安裝方式

### 1. 下載原始碼
將此資料夾下載到本機

### 2. 載入擴充功能

1. 開啟 Chrome 瀏覽器
2. 進入 `chrome://extensions/`
3. 開啟右上角的「開發人員模式」
4. 點擊「載入未封裝項目」
5. 選擇此專案資料夾：`youtube-subtitle-book-v2`
6. 完成！

### 3. 開啟 Side Panel

1. 前往 YouTube 影片頁面
2. 點擊擴充功能圖示
3. 選擇「在側邊面板中開啟」
4. 或使用快捷鍵開啟側邊面板

## 📖 使用方式

### 步驟1: 開啟YouTube影片
前往任何有硬編碼字幕的YouTube影片頁面

### 步驟2: 開啟側邊面板
點擊擴充功能圖示，側邊面板會自動開啟

### 步驟3: 設定參數
- **每頁行數**：一頁顯示幾行字幕（3-30行）
- **製作範圍**：全部或指定頁數
- **開始時間**：從頭或當前時間開始
- **截圖間隔**：每隔幾秒截取一次（1-10秒）

### 步驟4: 進階設定（可選）
展開「進階設定」可調整：
- 字幕區域高度
- 底部邊界
- 擷取模式（固定間隔/智慧偵測）
- 智慧偵測參數（靈敏度、檢測區域等）

### 步驟5: 開始製作
點擊「🚀 開始製作」按鈕

### 步驟6: 即時閱讀或完成後閱讀
- **即時閱讀**：製作中點擊「📖 即時閱讀」
- **完成後閱讀**：製作完成後點擊「✅ 開啟閱讀器」

## 📚 書庫管理

### 開啟書庫
點擊「📂 開啟書庫管理」進入書庫介面

### 書庫功能
- **載入段落**：將儲存的段落載入到閱讀器
- **刪除段落**：移除不需要的段落
- **PDF 導出**：單獨或批次導出 PDF
- **有聲書導出**：導出可離線播放的 HTML
- **資料備份**：導出/導入完整資料

## 🔧 技術架構

### 雙視窗協作機制 (Dual-Tab Architecture)

1. **Capture Tab (content.js)**
   - 駐留在 YouTube 影片頁面
   - 負責控制影片跳轉、截取畫面
   - 將資料寫入 `chrome.storage.local`

2. **Reader Tab (reader.js)**
   - 獨立的 Extension Page
   - 從 Storage 讀取並渲染內容
   - 處理所有編輯操作

### 截圖機制
```javascript
// 使用 Canvas API 截取影片的字幕區域
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');

// 只截取影片下方指定區域（字幕通常在此）
ctx.drawImage(video,
  0, subtitleY, videoWidth, subtitleHeight,
  0, 0, canvas.width, canvas.height
);

const screenshot = canvas.toDataURL('image/png');
```

## 📁 專案結構

```
youtube-subtitle-book-v2/
├── manifest.json          # Chrome 擴充功能配置
├── background.js          # 背景腳本（側邊面板控制）
├── sidepanel.html         # 側邊面板 UI
├── sidepanel.js           # 側邊面板邏輯
├── content.js             # 核心功能（截圖、組合）
├── content.css            # 影片頁面樣式
├── reader.html            # 閱讀器介面
├── reader.js              # 閱讀器邏輯
├── reader.css             # 閱讀器樣式
├── library.html           # 書庫管理介面
├── library.js             # 書庫管理邏輯
├── subtitleDetection.js   # 智慧偵測模組
├── theme.css              # 共用主題樣式
├── jspdf.umd.min.js       # PDF 生成庫
└── icon*.png              # 圖示檔案
```

## ⚠️ 注意事項

### 限制
1. **硬編碼字幕限定**：此工具針對影片中嵌入的字幕，不適用於 YouTube CC 字幕
2. **截圖數量**：長影片會產生大量截圖，佔用記憶體
3. **手動調整**：需要手動調整字幕區域高度參數以適應不同影片

### 效能建議
- 短影片（<10分鐘）：截圖間隔 1-2 秒
- 中等影片（10-30分鐘）：截圖間隔 2-3 秒
- 長影片（>30分鐘）：截圖間隔 3-5 秒

### 儲存空間
截圖以 Base64 格式儲存在 Chrome Storage 中：
- 每張 PNG 截圖約 50-100KB
- 10分鐘影片（間隔2秒）≈ 300張 ≈ 15-30MB

## ❓ 疑難排解

### Q: 截圖全黑或沒有內容？
A: 調整「字幕區域高度」參數，某些影片字幕位置可能不同

### Q: 製作速度很慢？
A: 正常現象，程式會自動加速播放。可使用智慧偵測模式減少不必要的截圖

### Q: 編輯後的內容會消失嗎？
A: 不會。採用即時儲存機制，所有編輯都會保留在瀏覽器儲存空間中

### Q: 如何備份我的資料？
A: 開啟書庫管理，使用「匯出全部」功能導出 JSON 檔案

## 📄 授權

MIT License

## 🔖 版本資訊

- **版本**: 2.0.0
- **更新日期**: 2026-01-23
- **Chrome 最低版本**: 114（支援 Manifest V3 Side Panel）
